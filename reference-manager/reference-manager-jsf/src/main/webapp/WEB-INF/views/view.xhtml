<?xml version="1.0"?>

<!-- 
    view.xhtml: view of the reference editor portlet
    
    Created:    2017-01-05 19:29 by Christian Berndt
    Modified:   2017-01-06 18:26 by Christian Berndt
    Version:    1.0.4
-->

<f:view xmlns="http://www.w3.org/1999/xhtml"
    xmlns:alloy="http://liferay.com/faces/alloy"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:p="http://primefaces.org/ui">

    <h:head>
        <h:outputStylesheet library="css" name="main.css" />
    </h:head>
    <h:body>
        <h:form id="form">

            <blockquote>#{tabbedView.citation}</blockquote>

            <p:messages id="messages" showDetail="false"
                autoUpdate="true" closable="true" />

            <p:outputPanel styleClass="form-group clearfix">

                <p:selectOneMenu disabled="#{tabbedView.disabled}"
                    id="entryType" styleClass="pull-left"
                    value="#{tabbedView.entryType}">
                    <p:ajax listener="#{tabbedView.onEntryTypeChange}"
                        update="@(form)" />
                    <f:selectItems value="#{tabbedView.entryTypes}" />
                </p:selectOneMenu>

                <h:link styleClass="btn btn-default pull-right"
                    value="Back">
                </h:link>

            </p:outputPanel>

            <p:tabView id="tabs" dynamic="true" cache="true">

                <p:ajax event="tabChange"
                    listener="#{tabbedView.onTabChange}" />

                <p:tab title="#{i18n['required-fields']}">

                    <p:outputPanel styleClass="form-group">
                        <p:outputLabel value="#{i18n['label']}" />
                        <p:inputText disabled="#{tabbedView.disabled}"
                            id="label" styleClass="form-control"
                            value="#{tabbedView.label}">
                            <f:ajax execute="@form" />
                            <p:ajax event="blur"
                                listener="#{tabbedView.onFieldChange}"
                                update=":form:tabs:bibtex" />
                        </p:inputText>
                    </p:outputPanel>

                    <p:repeat id="required-fields"
                        value="#{tabbedView.requiredFields}" var="field"
                        varStatus="loop">
                        <p:outputPanel styleClass="form-group">
                            <p:outputLabel
                                value="#{i18n[field.getString('name')]}" />
                            <p:inputText
                                disabled="#{tabbedView.disabled}"
                                styleClass="form-control"
                                value="#{tabbedView.requiredValues[loop.index]}">
                                <f:ajax execute="@form" />
                                <p:ajax event="blur"
                                    listener="#{tabbedView.onFieldChange}"
                                    update=":form:tabs:bibtex" />
                            </p:inputText>
                        </p:outputPanel>
                    </p:repeat>
                </p:tab>

                <p:tab id="optional-fields"
                    title="#{i18n['optional-fields']}">
                    <p:repeat value="#{tabbedView.optionalFields}"
                        var="field" varStatus="loop">
                        <p:outputPanel styleClass="form-group">
                            <p:outputLabel
                                value="#{i18n[field.getString('name')]}" />
                            <p:inputText
                                disabled="#{tabbedView.disabled}"
                                styleClass="form-control"
                                value="#{tabbedView.optionalValues[loop.index]}">
                                <f:ajax execute="@form" />
                                <p:ajax event="blur"
                                    listener="#{tabbedView.onFieldChange}"
                                    update=":form:tabs:bibtex" />
                            </p:inputText>
                        </p:outputPanel>
                    </p:repeat>
                </p:tab>

                <p:tab title="#{i18n['bibtex']}">
                    <p:outputPanel styleClass="form-group">
                        <p:outputLabel value="#{i18n['bibtex']}" />
                        <p:inputTextarea
                            disabled="#{tabbedView.disabled}"
                            id="bibtex" styleClass="form-control"
                            rows="20" value="#{tabbedView.bibTeX}">
                            <f:ajax execute="@form" />
                            <p:ajax event="blur"
                                listener="#{tabbedView.onBibTeXChange}"
                                update="@(form)" />
                        </p:inputTextarea>
                    </p:outputPanel>
                </p:tab>

            </p:tabView>

            <p:outputPanel styleClass="btn-group">
                <p:commandButton action="#{tabbedView.saveReference}"
                    styleClass="btn btn-default" update="@(form)"
                    value="#{i18n['save']}" />
                <p:commandButton value="#{i18n['cancel']}"
                    styleClass="btn" />
            </p:outputPanel>
        </h:form>
    </h:body>
</f:view>
