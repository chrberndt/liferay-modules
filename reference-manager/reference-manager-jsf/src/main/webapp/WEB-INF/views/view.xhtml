<?xml version="1.0"?>

<!-- 
    view.xhtml: view of the reference editor portlet
    
    Created:    2017-01-05 19:29 by Christian Berndt
    Modified:   2017-01-08 19:13 by Christian Berndt
    Version:    1.0.8
-->

<f:view xmlns="http://www.w3.org/1999/xhtml"
    xmlns:alloy="http://liferay.com/faces/alloy"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:p="http://primefaces.org/ui">

    <h:head>
        <h:outputStylesheet library="css" name="main.css" />
    </h:head>
    <h:body>
        <h:form id="form">

            <blockquote>#{referenceEditorView.citation}</blockquote>

            <p:messages id="messages" showDetail="false"
                autoUpdate="true" closable="true" />

            <p:outputPanel styleClass="form-group clearfix">

                <p:selectOneMenu disabled="#{referenceEditorView.disabled}"
                    id="entryType" styleClass="pull-left"
                    value="#{referenceEditorView.entryType}">
                    <p:ajax listener="#{referenceEditorView.onEntryTypeChange}"
                        update="@(form)" />
                    <f:selectItems value="#{referenceEditorView.entryTypes}" />
                </p:selectOneMenu>

                <h:outputLink
                    rendered="${not empty referenceEditorView.redirect}"
                    styleClass="btn btn-default pull-right"
                    value="#{referenceEditorView.redirect}">#{i18n['back']}</h:outputLink>

            </p:outputPanel>

            <p:tabView id="tabs" dynamic="true" cache="true">

                <p:ajax event="tabChange"
                    listener="#{referenceEditorView.onTabChange}" />

                <p:tab title="#{i18n['required-fields']}">

                    <p:outputPanel styleClass="form-group">
                        <p:outputLabel value="#{i18n['label']}" />
                        <p:inputText disabled="#{referenceEditorView.disabled}"
                            id="label" styleClass="form-control"
                            value="#{referenceEditorView.label}">
                            <f:ajax execute="@form" />
                            <p:ajax event="blur"
                                listener="#{referenceEditorView.onFieldChange}"
                                update=":form:tabs:bibtex" />
                        </p:inputText>
                    </p:outputPanel>

                    <p:repeat id="required-fields"
                        value="#{referenceEditorView.requiredFields}" var="field"
                        varStatus="loop">
                        <p:outputPanel styleClass="form-group">
                            <p:outputLabel
                                value="#{i18n[field.getString('name')]}" />
                            <p:inputText
                                disabled="#{referenceEditorView.disabled}"
                                styleClass="form-control"
                                value="#{referenceEditorView.requiredValues[loop.index]}">
                                <f:ajax execute="@form" />
                                <p:ajax event="blur"
                                    listener="#{referenceEditorView.onFieldChange}"
                                    update=":form:tabs:bibtex" />
                            </p:inputText>
                        </p:outputPanel>
                    </p:repeat>
                </p:tab>

                <p:tab id="optional-fields"
                    title="#{i18n['optional-fields']}">
                    <p:repeat value="#{referenceEditorView.optionalFields}"
                        var="field" varStatus="loop">
                        <p:outputPanel styleClass="form-group">
                            <p:outputLabel
                                value="#{i18n[field.getString('name')]}" />
                            <p:inputText
                                disabled="#{referenceEditorView.disabled}"
                                styleClass="form-control"
                                value="#{referenceEditorView.optionalValues[loop.index]}">
                                <f:ajax execute="@form" />
                                <p:ajax event="blur"
                                    listener="#{referenceEditorView.onFieldChange}"
                                    update=":form:tabs:bibtex" />
                            </p:inputText>
                        </p:outputPanel>
                    </p:repeat>
                </p:tab>

                <p:tab title="#{i18n['bibtex']}">
                    <p:outputPanel styleClass="form-group">
                        <p:outputLabel value="#{i18n['bibtex']}" />
                        <p:inputTextarea
                            disabled="#{referenceEditorView.disabled}"
                            id="bibtex" styleClass="form-control"
                            rows="10" value="#{referenceEditorView.bibTeX}">
                            <f:ajax execute="@form" />
                            <p:ajax event="blur"
                                listener="#{referenceEditorView.onBibTeXChange}"
                                update="@(form)" />
                        </p:inputTextarea>
                    </p:outputPanel>
                </p:tab>

            </p:tabView>

            <p:outputPanel>
                <p:commandButton action="#{referenceEditorView.saveReference}"
                    disabled="#{referenceEditorView.disabled}"
                    styleClass="btn" update="@(form)"
                    value="#{i18n['save']}" />
                <h:outputLink
                    rendered="${not empty referenceEditorView.redirect}"
                    styleClass="btn" value="#{referenceEditorView.redirect}">#{i18n['cancel']}</h:outputLink>
            </p:outputPanel>
        </h:form>
    </h:body>
</f:view>
